import{n as c,F as u,V as h}from"./FlipItem-CXiVc3UF.js";const p={components:{FlipItem:u},name:"TomatoPage",data(){return{isWork:!0,workMinutes:25,breakMinutes:5,remainingSeconds:1500,isRunning:!1,timerId:null,minMinutes:0,maxMinutes:59,dragging:!1,dragStartX:0,dragStartMinutes:25,sliderCenter:0,sliderH:26,pxPerMinute:12,showSettings:!1,bgColor:"transparent",flipScale:1.5,flipOpacity:0,showAlert:!1,alertMessage:"",audioCtx:null,clickTimer:null,viewportH:typeof window<"u"?window.innerHeight:800,clockH:0}},computed:{mm(){const i=Math.floor(this.remainingSeconds/60);return String(i).padStart(2,"0")},ss(){const i=this.remainingSeconds%60;return String(i).padStart(2,"0")},mTens(){return Math.floor(Math.floor(this.remainingSeconds/60)/10)},mOnes(){return Math.floor(this.remainingSeconds/60)%10},sTens(){return Math.floor(this.remainingSeconds%60/10)},sOnes(){return this.remainingSeconds%10},sliderStyle(){const t=this.isRunning||this.isPartial?this.remainingSeconds/60:this.workMinutes,e=Math.min(Math.max(t,this.minMinutes),this.maxMinutes),s=this.sliderCenter||(this.$refs.sliderWrap?this.$refs.sliderWrap.offsetWidth/2:0),n=this.viewportH/2+this.clockH/2+75,r=this.pxPerMinute*this.flipScale,a=(this.maxMinutes-this.minMinutes)*r,l=s-(e-this.minMinutes)*r;return{position:"absolute",left:"50%",transform:"translateX(-50%)",top:`${n-this.sliderH/2}px`,"--tx":`${l}px`,"--track-w":`${a}px`,"--tick-unit":`${r}px`,"--tick-major-unit":`${r*5}px`}},pageStyle(){return this.bgColor==="transparent"?{background:"transparent"}:{backgroundColor:this.bgColor}},flipStyle(){const i=Math.max(0,Math.min(1,this.flipOpacity));return{position:"absolute",left:"50%",top:"50%",transform:`translate(-50%, -50%) scale(${this.flipScale})`,transformOrigin:"center",opacity:1-i}},sessionTotalSeconds(){return(this.isWork?this.workMinutes:this.breakMinutes)*60},isPartial(){return!this.isRunning&&this.remainingSeconds>0&&this.remainingSeconds<this.sessionTotalSeconds},isIdle(){return!this.isRunning&&this.remainingSeconds===this.sessionTotalSeconds},actionStyle(){return{position:"absolute",left:"50%",transform:"translateX(-50%)",top:`${this.viewportH/2+this.clockH/2+100}px`}}},watch:{bgColor(){this.saveUiSettings()},flipScale(){this.saveUiSettings(),this.updateClockLayout(),this.updateSliderCenter()},flipOpacity(){this.saveUiSettings()}},created(){const i=localStorage.getItem("pomodoro-settings");if(i)try{const t=JSON.parse(i);typeof t.workMinutes=="number"&&(this.workMinutes=t.workMinutes),typeof t.breakMinutes=="number"&&(this.breakMinutes=t.breakMinutes)}catch{}this.resetToSession()},beforeDestroy(){this.clearTimer()},mounted(){this.updateClockLayout(),this.updateSliderCenter(),window.addEventListener("resize",this.onResize),window.addEventListener("resize",this.updateSliderCenter),this.loadUiSettings()},beforeDestroy(){this.clearTimer(),window.removeEventListener("resize",this.updateSliderCenter),window.removeEventListener("resize",this.onResize),this.clickTimer&&(clearTimeout(this.clickTimer),this.clickTimer=null)},methods:{onResize(){this.viewportH=typeof window<"u"?window.innerHeight:this.viewportH,this.updateClockLayout(),this.updateSliderCenter()},onClockClick(i){this.clickTimer&&(clearTimeout(this.clickTimer),this.clickTimer=null),this.clickTimer=setTimeout(()=>{this.toggleRun(),this.clickTimer=null},250)},onClockDblClick(){this.clickTimer&&(clearTimeout(this.clickTimer),this.clickTimer=null),this.openSettings()},toggleRun(){this.isRunning?this.pause():this.start()},start(){if(!this.isRunning){if(this.sessionTotalSeconds<=0){this.openAlert("番茄钟设置最小时间为1分钟");return}this.initAudioCtx(),this.isRunning=!0,this.timerId=setInterval(()=>{this.remainingSeconds>0&&(this.remainingSeconds-=1),this.remainingSeconds<=0&&this.completeSession()},1e3)}},pause(){this.isRunning=!1,this.clearTimer()},reset(){this.pause(),this.resetToSession()},skip(){this.pause(),this.isWork=!this.isWork,this.resetToSession()},resetWork(){this.pause(),this.isWork=!0,this.remainingSeconds=this.workMinutes*60},resetToSession(){this.remainingSeconds=(this.isWork?this.workMinutes:this.breakMinutes)*60},completeSession(){const i=this.isWork;this.pause(),i&&this.playBeep(),this.isWork=!this.isWork,this.resetToSession()},clearTimer(){this.timerId&&(clearInterval(this.timerId),this.timerId=null)},onTrackMouseDown(i){this.isRunning||(this.initAudioCtx(),this.dragging=!0,this.dragStartX=i.clientX,this.dragStartMinutes=this.workMinutes,window.addEventListener("mousemove",this.onTrackMouseMove),window.addEventListener("mouseup",this.onTrackMouseUp))},updateClockLayout(){this.$nextTick(()=>{const i=this.$refs.clock;if(i){const t=i.getBoundingClientRect();this.clockH=t&&t.height?t.height:this.clockH}})},onTrackMouseMove(i){if(!this.dragging)return;const t=i.clientX-this.dragStartX,e=this.pxPerMinute*this.flipScale,s=Math.round(this.dragStartMinutes+t/e);this.setWorkMinutes(s)},onTrackMouseUp(){this.dragging&&(this.dragging=!1,window.removeEventListener("mousemove",this.onTrackMouseMove),window.removeEventListener("mouseup",this.onTrackMouseUp),this.applyDuration())},onTrackTouchStart(i){if(this.isRunning)return;const t=i.touches&&i.touches[0];t&&(this.initAudioCtx(),this.dragging=!0,this.dragStartX=t.clientX,this.dragStartMinutes=this.workMinutes,window.addEventListener("touchmove",this.onTrackTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTrackTouchEnd),window.addEventListener("touchcancel",this.onTrackTouchEnd))},onTrackTouchMove(i){if(!this.dragging)return;const t=i.touches&&i.touches[0];if(!t)return;const e=t.clientX-this.dragStartX,s=this.pxPerMinute*this.flipScale,o=Math.round(this.dragStartMinutes+e/s);this.setWorkMinutes(o)},onTrackTouchEnd(){this.dragging&&(this.dragging=!1,window.removeEventListener("touchmove",this.onTrackTouchMove),window.removeEventListener("touchend",this.onTrackTouchEnd),window.removeEventListener("touchcancel",this.onTrackTouchEnd),this.applyDuration())},setWorkMinutes(i){const t=Math.max(this.minMinutes,Math.min(this.maxMinutes,i));t!==this.workMinutes&&(this.workMinutes,this.workMinutes=t,this.isRunning||(this.remainingSeconds=t*60),this.dragging&&(t%5===0?this.playMajorTick():this.playTick()))},updateSliderCenter(){this.$nextTick(()=>{this.$refs.sliderWrap&&(this.sliderCenter=this.$refs.sliderWrap.offsetWidth/2,this.sliderH=this.$refs.sliderWrap.offsetHeight||this.sliderH)})},applyDuration(){localStorage.setItem("pomodoro-settings",JSON.stringify({workMinutes:this.workMinutes,breakMinutes:this.breakMinutes})),this.isRunning||this.resetToSession()},openSettings(){this.showSettings=!0},closeSettings(){this.showSettings=!1},openAlert(i){this.alertMessage=i||"",this.showAlert=!0},closeAlert(){this.showAlert=!1,this.alertMessage=""},initAudioCtx(){try{if(!this.audioCtx){const i=window.AudioContext||window.webkitAudioContext;i&&(this.audioCtx=new i)}this.audioCtx&&this.audioCtx.state==="suspended"&&this.audioCtx.resume().catch(()=>{})}catch{}},playBeep(){try{this.initAudioCtx();const i=this.audioCtx;if(!i)return;const t=i.createOscillator(),e=i.createGain();t.type="sine",t.frequency.value=880,e.gain.setValueAtTime(0,i.currentTime),e.gain.linearRampToValueAtTime(.12,i.currentTime+.02),e.gain.exponentialRampToValueAtTime(1e-4,i.currentTime+.35),t.connect(e),e.connect(i.destination),t.start(),t.stop(i.currentTime+.4)}catch{}},playTick(){try{this.initAudioCtx();const i=this.audioCtx;if(!i)return;const t=i.createOscillator(),e=i.createGain();t.type="triangle",t.frequency.value=1400,e.gain.setValueAtTime(0,i.currentTime),e.gain.linearRampToValueAtTime(.045,i.currentTime+.01),e.gain.exponentialRampToValueAtTime(1e-4,i.currentTime+.06),t.connect(e),e.connect(i.destination),t.start(),t.stop(i.currentTime+.08)}catch{}},playMajorTick(){try{this.initAudioCtx();const i=this.audioCtx;if(!i)return;const t=i.createOscillator(),e=i.createGain();t.type="square",t.frequency.value=900,e.gain.setValueAtTime(0,i.currentTime),e.gain.linearRampToValueAtTime(.055,i.currentTime+.015),e.gain.exponentialRampToValueAtTime(1e-4,i.currentTime+.09),t.connect(e),e.connect(i.destination),t.start(),t.stop(i.currentTime+.12)}catch{}},saveUiSettings(){const i={bgColor:this.bgColor,flipScale:this.flipScale,flipOpacity:this.flipOpacity};try{localStorage.setItem("pomodoro-ui",JSON.stringify(i))}catch{}},loadUiSettings(){try{const i=localStorage.getItem("pomodoro-ui");if(!i)return;const t=JSON.parse(i);t&&typeof t=="object"&&(typeof t.bgColor=="string"&&(this.bgColor=t.bgColor),typeof t.flipScale=="number"&&(this.flipScale=t.flipScale),typeof t.flipOpacity=="number"&&(this.flipOpacity=t.flipOpacity))}catch{}}}};var d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pomodoro-page",style:t.pageStyle},[e("div",{ref:"clock",staticClass:"flip-countdown",style:t.flipStyle,on:{click:t.onClockClick,dblclick:function(s){return s.stopPropagation(),s.preventDefault(),t.onClockDblClick.apply(null,arguments)}}},[e("flip-item",{attrs:{total:5,current:t.mTens}}),e("flip-item",{attrs:{total:9,current:t.mOnes}}),e("div",{staticClass:"colon"}),e("flip-item",{attrs:{total:5,current:t.sTens}}),e("flip-item",{attrs:{total:9,current:t.sOnes}})],1),e("div",{ref:"sliderWrap",staticClass:"slider-wrap",style:t.sliderStyle},[e("div",{staticClass:"slider-track",on:{mousedown:t.onTrackMouseDown,touchstart:function(s){return s.preventDefault(),s.stopPropagation(),t.onTrackTouchStart.apply(null,arguments)}}},[e("div",{staticClass:"ticks minor"}),e("div",{staticClass:"ticks major"}),e("div",{staticClass:"ticks center-minor"}),t._m(0)])]),e("div",{staticClass:"action",style:t.actionStyle},[t.isRunning?[e("button",{staticClass:"btn-primary",on:{click:t.pause}},[t._v("暂停")]),e("button",{staticClass:"btn-secondary",on:{click:t.resetWork}},[t._v("重置")])]:t.isPartial?[e("button",{staticClass:"btn-primary",on:{click:t.start}},[t._v("继续")]),e("button",{staticClass:"btn-secondary",on:{click:t.resetWork}},[t._v("重置")])]:[e("button",{staticClass:"btn-primary",on:{click:t.start}},[t._v("开始")])]],2),t.showSettings?e("div",{staticClass:"modal-overlay",on:{click:function(s){return s.target!==s.currentTarget?null:t.closeSettings.apply(null,arguments)}}},[e("div",{staticClass:"modal"},[e("h3",[t._v("设置")]),e("label",[t._v(" 背景色 "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.bgColor,expression:"bgColor"}],on:{change:function(s){var o=Array.prototype.filter.call(s.target.options,function(n){return n.selected}).map(function(n){var r="_value"in n?n._value:n.value;return r});t.bgColor=s.target.multiple?o:o[0]}}},[e("option",{attrs:{value:"transparent"}},[t._v("透明")]),e("option",{attrs:{value:"#4c8045"}},[t._v("翠微")]),e("option",{attrs:{value:"#b2b6b6"}},[t._v("月魄")]),e("option",{attrs:{value:"#bfc1a9"}},[t._v("草白")]),e("option",{attrs:{value:"#a8bf8f"}},[t._v("苍葭")]),e("option",{attrs:{value:"#779649"}},[t._v("碧山")]),e("option",{attrs:{value:"#778a77"}},[t._v("青梅")]),e("option",{attrs:{value:"#709bc8"}},[t._v("挼蓝")]),e("option",{attrs:{value:"#246eab"}},[t._v("景泰")]),e("option",{attrs:{value:"#ecd354"}},[t._v("缃叶")]),e("option",{attrs:{value:"#da9b32"}},[t._v("黄不老")]),e("option",{attrs:{value:"#cd5c20"}},[t._v("光明砂")]),e("option",{attrs:{value:"#c9adc4"}},[t._v("凤信")]),e("option",{attrs:{value:"#8c6abe"}},[t._v("紫藤")]),e("option",{attrs:{value:"#843e87"}},[t._v("桔梗")]),e("option",{attrs:{value:"#ad6593"}},[t._v("豆蔻")]),e("option",{attrs:{value:"#090b0c"}},[t._v("墨黑")]),e("option",{attrs:{value:"#ffc0cb"}},[t._v("樱花粉")])])]),e("label",[t._v(" 放大倍数 "),e("select",{directives:[{name:"model",rawName:"v-model.number",value:t.flipScale,expression:"flipScale",modifiers:{number:!0}}],on:{change:function(s){var o=Array.prototype.filter.call(s.target.options,function(n){return n.selected}).map(function(n){var r="_value"in n?n._value:n.value;return t._n(r)});t.flipScale=s.target.multiple?o:o[0]}}},[e("option",{domProps:{value:.5}},[t._v("0.5")]),e("option",{domProps:{value:1}},[t._v("1")]),e("option",{domProps:{value:1.5}},[t._v("1.5")]),e("option",{domProps:{value:2}},[t._v("2")]),e("option",{domProps:{value:2.5}},[t._v("2.5")]),e("option",{domProps:{value:3}},[t._v("3")])])]),e("label",[t._v(" 时钟透明度 "),e("select",{directives:[{name:"model",rawName:"v-model.number",value:t.flipOpacity,expression:"flipOpacity",modifiers:{number:!0}}],on:{change:function(s){var o=Array.prototype.filter.call(s.target.options,function(n){return n.selected}).map(function(n){var r="_value"in n?n._value:n.value;return t._n(r)});t.flipOpacity=s.target.multiple?o:o[0]}}},[e("option",{domProps:{value:0}},[t._v("0")]),e("option",{domProps:{value:.25}},[t._v("25%")]),e("option",{domProps:{value:.5}},[t._v("50%")]),e("option",{domProps:{value:.75}},[t._v("75%")]),e("option",{domProps:{value:1}},[t._v("100%")])])]),e("div",{staticClass:"modal-actions"},[e("button",{on:{click:t.closeSettings}},[t._v("关闭")])])])]):t._e(),t.showAlert?e("div",{staticClass:"modal-overlay",on:{click:function(s){return s.target!==s.currentTarget?null:t.closeAlert.apply(null,arguments)}}},[e("div",{staticClass:"modal"},[e("h3",[t._v("提示")]),e("p",{staticClass:"modal-message"},[t._v(t._s(t.alertMessage))]),e("div",{staticClass:"modal-actions"},[e("button",{on:{click:t.closeAlert}},[t._v("知道了")])])])]):t._e()])},m=[function(){var i=this,t=i._self._c;return t("div",{staticClass:"thumb"},[t("div",{staticClass:"stick"}),t("div",{staticClass:"dot"})])}],g=c(p,d,m,!1,null,"efaa5ce5");const v=g.exports;new h({render:i=>i(v)}).$mount("#app");
